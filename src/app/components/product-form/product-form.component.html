<div class="container mt-4">
  <div class="row">
    <div class="col-md-8 offset-md-2">
      <div class="card">
        <div class="card-header">
          <h3>{{ isEditMode ? 'Edit Product' : 'Add New Product' }}</h3>
        </div>
        <div class="card-body">
          <form (ngSubmit)="saveProduct()" #productForm="ngForm">

            <!-- Name -->
            <div class="mb-3">
              <label class="form-label">Product Name *</label>
              <input type="text" class="form-control" [(ngModel)]="product.name" name="name" required>
            </div>

            <!-- Description -->
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" rows="3" [(ngModel)]="product.description" name="description"></textarea>
            </div>

            <!-- Price & Quantity -->
            <div class="row mb-3">
              <div class="col-md-6">
                <label class="form-label">Price *</label>
                <input type="number" class="form-control" [(ngModel)]="product.price" name="price" min="0" step="0.01" required>
              </div>
              <div class="col-md-6">
                <label class="form-label">Quantity *</label>
                <input type="number" class="form-control" [(ngModel)]="product.quantity" name="quantity" min="0" required>
              </div>
            </div>

            <!-- âœ… FIXED: Category / Supplier / Store - Use ID binding -->
            <div class="row mb-3">
              <div class="col-md-4">
                <label class="form-label">Category *</label>
                <select class="form-select" [(ngModel)]="product.categoryId" name="categoryId" required>
                  <option [value]="undefined" disabled>Select Category</option>
                  <option *ngFor="let c of categories" [value]="c.id">{{c.name}}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Supplier *</label>
                <select class="form-select" [(ngModel)]="product.supplierId" name="supplierId" required>
                  <option [value]="undefined" disabled>Select Supplier</option>
                  <option *ngFor="let s of suppliers" [value]="s.id">{{s.name}}</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Store *</label>
                <select class="form-select" [(ngModel)]="product.storeId" name="storeId" required>
                  <option [value]="undefined" disabled>Select Store</option>
                  <option *ngFor="let s of stores" [value]="s.id">{{s.name}}</option>
                </select>
              </div>
            </div>

            <!-- Image Upload -->
            <div class="mb-3">
              <label class="form-label">Product Image</label>
              <input type="file" class="form-control" (change)="onFileSelected($event)" accept="image/*">
              <div *ngIf="imagePreview" class="mt-2">
                <img [src]="imagePreview" alt="Preview" class="img-thumbnail" style="max-height:200px;">
                <button type="button" class="btn btn-sm btn-outline-danger ms-2" (click)="removeImage()">Remove Image</button>
              </div>
            </div>

            <!-- Buttons -->
            <div class="d-flex gap-2">
              <button type="submit" class="btn btn-primary" [disabled]="loading"> 
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                {{ isEditMode ? 'Update' : 'Create' }} Product
              </button>
              <button type="button" class="btn btn-secondary" (click)="cancel()" [disabled]="loading">Cancel</button>
            </div>

          </form>
        </div>
      </div>
    </div>
  </div>
</div>