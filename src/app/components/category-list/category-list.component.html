<div class="container-fluid mt-4">
  <!-- Header Section -->
  <div class="row mb-4">
    <div class="col">
      <div class="d-flex justify-content-between align-items-center">
        <div>
          <h2>
            <i class="fas fa-tags me-2"></i>Category Management
          </h2>
          <p class="text-muted mb-0">Organize your products into categories</p>
        </div>
        <button class="btn btn-primary" (click)="addNewCategory()">
          <i class="fas fa-plus me-2"></i>Add New Category
        </button>
      </div>
    </div>
  </div>

  <!-- Search Section -->
  <div class="card mb-4">
    <div class="card-body">
      <div class="row align-items-end">
        <div class="col-md-6">
          <label for="search" class="form-label">Search Categories</label>
          <div class="input-group">
            <span class="input-group-text">
              <i class="fas fa-search"></i>
            </span>
            <input
              type="text"
              class="form-control"
              id="search"
              placeholder="Search by name or description..."
              [(ngModel)]="searchTerm"
              (input)="onSearchChange()">
            <button 
              *ngIf="searchTerm" 
              class="btn btn-outline-secondary" 
              type="button"
              (click)="clearSearch()">
              <i class="fas fa-times"></i>
            </button>
          </div>
        </div>
        <div class="col-md-6">
          <div class="d-flex justify-content-end align-items-center">
            <div class="text-muted me-3">
              <small>{{ totalItems }} categories found</small>
            </div>
            <div class="d-flex align-items-center">
              <label class="me-2 small text-muted">Show:</label>
              <select 
                class="form-select form-select-sm w-auto" 
                [(ngModel)]="pageSize"
                (change)="onPageSizeChange()">
                <option value="5">5</option>
                <option value="10">10</option>
                <option value="20">20</option>
                <option value="50">50</option>
              </select>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-2">Loading categories...</p>
  </div>

  <!-- Categories Grid -->
  <div *ngIf="!loading" class="row">
    <!-- Category Cards -->
    <div *ngFor="let category of paginatedCategories" class="col-xl-4 col-lg-6 col-md-6 mb-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start mb-3">
            <h5 class="card-title mb-0 text-truncate" [title]="category.name">{{ category.name }}</h5>
            <div class="d-flex flex-column align-items-end">
              <!-- UPDATED: Use getProductCountText for proper pluralization -->
              <span class="badge bg-primary rounded-pill mb-1">
                {{ getProductCountText(category) }}
              </span>
              <!-- UPDATED: Show warning only if category has products, but don't prevent deletion -->
              <span *ngIf="hasProducts(category)" 
                    class="badge bg-warning text-dark rounded-pill small"
                    title="This category contains products">
                <i class="fas fa-box me-1"></i>Contains Products
              </span>
            </div>
          </div>
          
          <p class="card-text text-muted small">
            {{ getDescriptionPreview(category.description) }}
          </p>
        </div>
        
        <div class="card-footer bg-transparent">
          <div class="btn-group w-100" role="group">
            <button
              type="button"
              class="btn btn-outline-primary btn-sm"
              (click)="viewCategory(category)"
              title="View Category">
              <i class="fas fa-eye"></i>
            </button>
            <button
              type="button"
              class="btn btn-outline-warning btn-sm"
              (click)="editCategory(category)"
              title="Edit Category">
              <i class="fas fa-edit"></i>
            </button>
            <!-- UPDATED: Allow deletion but show warning state -->
            <button
              type="button"
              class="btn btn-outline-danger btn-sm"
              (click)="deleteCategory(category)"
              [disabled]="deleting && deleteCategoryId === category.id"
              [title]="hasProducts(category) ? 'Delete category (contains ' + getProductCountText(category) + ')' : 'Delete Category'"
              [class.btn-warning]="hasProducts(category)"
              [class.text-dark]="hasProducts(category)"
              [class.border-warning]="hasProducts(category)">
              <span *ngIf="deleting && deleteCategoryId === category.id" 
                    class="spinner-border spinner-border-sm me-1"></span>
              <i class="fas fa-trash"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="filteredCategories.length === 0" class="col-12">
      <div class="card border-dashed">
        <div class="card-body text-center py-5">
          <div class="text-muted">
            <i class="fas fa-tags fa-4x mb-3 opacity-50"></i>
            <h4 class="mb-3">No categories found</h4>
            <p *ngIf="searchTerm" class="mb-4">
              No categories match "<strong>{{ searchTerm }}</strong>". Try adjusting your search terms.
            </p>
            <div *ngIf="!searchTerm" class="mb-4">
              <p>Get started by organizing your products into categories.</p>
              <p class="small">Categories help customers find products easily and improve your store's organization.</p>
            </div>
            <button class="btn btn-primary btn-lg" (click)="addNewCategory()">
              <i class="fas fa-plus me-2"></i>Create Your First Category
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div *ngIf="!loading && totalPages > 1" class="row mt-4">
    <div class="col">
      <nav aria-label="Category pagination">
        <ul class="pagination justify-content-center">
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage - 1)">
              <i class="fas fa-chevron-left me-1"></i>Previous
            </a>
          </li>
          
          <li *ngFor="let page of pages" class="page-item" [class.active]="page === currentPage">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(page)">
              {{ page }}
            </a>
          </li>
          
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" href="javascript:void(0)" (click)="goToPage(currentPage + 1)">
              Next<i class="fas fa-chevron-right ms-1"></i>
            </a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>